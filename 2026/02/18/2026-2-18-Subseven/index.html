<!DOCTYPE html><html lang="en-us" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>[Studying] Analyzing Sub7 (SubSeven) | ISSAC/iss4cf0ng's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":true,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ISSAC/iss4cf0ng's blog" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/About/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/Alien/"><span class="navItemTitle">Alien</span></a></li><li class="navItem"><a class="navBlock" href="/2026/01/28/2026-1-28-ToolsDuplexSpy-v2-0-0/"><span class="navItemTitle">DuplexSpy</span></a></li><li class="navItem"><a class="navBlock" href="/Notes/"><span class="navItemTitle">Notes</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[Studying] Analyzing Sub7 (SubSeven)</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2026-02-18T08:53:31.000Z" id="date"> 2026-02-18</time></div></span><br><span>Last Update: <div class="control"><time datetime="2026-02-27T15:26:26.939Z" id="updated"> 2026-02-27</time></div></span><br><span>Word Count: <div class="control">1.2k</div></span><br><span>Read Time: <div class="control">7 min</div></span></div></div><hr><div id="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>This article is part of my series: <a href="https://iss4cf0ng.github.io/2026/02/18/2026-2-18-StudyingRAT/">Inside Different Generations of RATs</a>. If you are interested in the full series, please visit the linked page.</p>
<p align="center" class='item-img' data-src='/images/meme/nagisa_neko.png'><img src="/images/meme/nagisa_neko.png" width=300>
</p>

<h1 id="Sub7"><a href="#Sub7" class="headerlink" title="Sub7"></a>Sub7</h1><p>Sub7 (SubSeven/Sub7Server) is a remote access trojan which was originally released in Februry 1999.</p>
<p>Starting with version 2.1 (1999) it could be controlled via IRC. It works on the Windows 9x and Windows NT operating systems.</p>
<p>Many versions were released over time. The latest release is version 2.3. In this article, I analyzed version 2.0, since it is the only ersion that functions properly in my test environment.</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/3.png'><img src="/images/article/2026-2-18-Sub7/3.png" width=600>
</p>

<h1 id="Experimental-Environment"><a href="#Experimental-Environment" class="headerlink" title="Experimental Environment"></a>Experimental Environment</h1><p>To safety conduct malware analysis, the environment should be isolated using virtual machines. Under no circumstances should malware be executed on a personal or production system.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ExeInfo</td>
<td>Static analysis tool for examing PE file</td>
</tr>
<tr>
<td>DIE (Detect It Easy)</td>
<td>Static analysis tool for examing PE file</td>
</tr>
<tr>
<td>CFF Explorer</td>
<td>PE file editor and analyzer developed by NTCore, supporting 32-bit/64-bit executables and .NET assemblies</td>
</tr>
<tr>
<td>UPX</td>
<td>Executable packer/unpacker</td>
</tr>
<tr>
<td>AsDie</td>
<td>ASPack detection tool</td>
</tr>
<tr>
<td>Wireshark</td>
<td>Network protocol analyzer used to capture and inspect live or recorded traffic</td>
</tr>
<tr>
<td>OllyDbg</td>
<td>32-bit user-mode debugger</td>
</tr>
<tr>
<td>x32dbg</td>
<td>32-bit debugger</td>
</tr>
<tr>
<td>Ghidra</td>
<td>Open-source software reverse engineering framework developed by the NSA</td>
</tr>
</tbody>
</table>
</div>
<hr>
<div class="table-container">
<table>
<thead>
<tr>
<th>Device</th>
<th>IP Address</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows XP</td>
<td>192.168.85.2</td>
<td>Victim machine used for executing both the controller and payload</td>
</tr>
<tr>
<td>Windows 10 x64 (VM)</td>
<td>192.168.85.3</td>
<td>Analysis machine used for reverse engineering</td>
</tr>
</tbody>
</table>
</div>
<p>If you want to know how to set up your experimental enviroment, please view:</p>
<ul>
<li><a href="https://iss4cf0ng.github.io/2026/02/21/2026-2-21-HowToSetupYourExpEnv/">How to Setup Your Experimental Environment for Malware Analysis</a></li>
<li><a href="https://iss4cf0ng.github.io/2026/02/21/2026-2-21-WinXpVMWareTool/">Installing VMware Tools on Windows XP and Windows 95 with VMware WorkStation 17</a></li>
</ul>
<p align="center" class='item-img' data-src='/images/meme/rio_pc.jpg'><img src="/images/meme/rio_pc.jpg" width=300>
</p>

<h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>The GUI of client (attacker-side) is illustrated below:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/4.png'><img src="/images/article/2026-2-18-Sub7/4.png" width=400>
</p>

<p>Before we deploy the payload, we need to configure it. Launch <code>EditServer.exe</code>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/10.png'><img src="/images/article/2026-2-18-Sub7/10.png" width=500>
</p>

<p>Here, the term “Server” might be confusing from a modern perspective. In early-generation RATs, a “server” executable referred to the payload deployed on the victim machine, while a “client” referred to an application used for controlling the victim machines. As firewall technologies evolved and network security improved, attackers gradually shifted from direct connections to reverse connections.</p>
<p>To avoid confusing, this article uses the terms:</p>
<ul>
<li>Controller: attacker-side application</li>
<li>Payload: executable deployed on the victim machines</li>
</ul>
<p>Note that Sub7 2.3 provides <strong>Normal</strong> and <strong>Advanced</strong> configuration:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/5.png'><img src="/images/article/2026-2-18-Sub7/5.png" width=500>
</p>

<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/6.png'><img src="/images/article/2026-2-18-Sub7/6.png" width=500>
    <img src="/images/article/2026-2-18-Sub7/7.png" width=500>
</p>

<p>Normal mode provides most of the commonly used options, while Advanced mode allows the use of a downloader and enables appending commands to the payload for execution during the initial deployment stage.</p>
<p>The configuration wizard also provides persistence and plugin functionality:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/8.png'><img src="/images/article/2026-2-18-Sub7/8.png" width=700>
</p>

<p>Here <code>server.exe</code> is the stub for building a payload. The principle is straightforward: the builder modifies <code>server.exe</code> and saves the result as a new executable file.</p>
<p>After building the payload, deploy it on the target machine (Windows XP).</p>
<p>Once you connected to the payload, you can see the message at the bottom of the GUI (commonly referred to as the <strong>StatusStrip</strong> in Windows application development):</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/11.png'><img src="/images/article/2026-2-18-Sub7/11.png" width=500>
</p>

<h1 id="Protocol-Analysis"><a href="#Protocol-Analysis" class="headerlink" title="Protocol Analysis"></a>Protocol Analysis</h1><p>The communication channel is not encrypted. Data is transmitted in plain text:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/13.png'><img src="/images/article/2026-2-18-Sub7/13.png" width=700>
</p>

<h1 id="Reverse-Engineering"><a href="#Reverse-Engineering" class="headerlink" title="Reverse Engineering"></a>Reverse Engineering</h1><h2 id="Unpacking"><a href="#Unpacking" class="headerlink" title="Unpacking"></a>Unpacking</h2><p>Open <code>Server.exe</code> using <strong>ExeInfo</strong> and <strong>DIE (Detect It Easy)</strong>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/12.png'><img src="/images/article/2026-2-18-Sub7/12.png" width=500>
    <img src="/images/article/2026-2-18-Sub7/14.png" width=500>
</p>

<p>Both tools confirm that the payload was compiled by <strong>Object Pascal (Delphi)</strong> and packed by <strong>UPX</strong>. However, version 2.3 is packed by ASPack:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/1.png'><img src="/images/article/2026-2-18-Sub7/1.png" width=500>
    <img src="/images/article/2026-2-18-Sub7/2.png" width=500>
</p>

<p>Unpacking UPX and older version of ASPack is relatively easy nowadays, as many tools are publicly available…</p>
<p>Well, the truth is: in my case, the UPX tool failed to unpack the payload:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/18.png'><img src="/images/article/2026-2-18-Sub7/18.png" width=800>
</p>

<p>I tried <code>UPX5.1.0</code> and <code>UPX3.0</code>, but encountered the same exception:</p>
<blockquote>
<p>CantUnpackException: this program is packed with an obsolete version and cannot be unpacked</p>
</blockquote>
<p>Therefore, I started learning how to manually unpack the payload using <strong>x32dbg</strong> (since this is a 32-bit PE file), <strong>OllyDbg</strong> and <strong>Scylla</strong>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/15.png'><img src="/images/article/2026-2-18-Sub7/15.png" width=800>
</p>

<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/16.png'><img src="/images/article/2026-2-18-Sub7/16.png" width=800>
</p>

<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/17.png'><img src="/images/article/2026-2-18-Sub7/17.png" width=800>
</p>

<p>Everything initially appeared successful. However, when I opened the unpacked payload with <strong>ExeInfo</strong>, it was still detected as UPX-packed. Additionally, TLS protection was present.</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/24.png'><img src="/images/article/2026-2-18-Sub7/24.png" width=700>
</p>

<p>After opening the file in Ghidra, the results confirmed this observation:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/21.png'><img src="/images/article/2026-2-18-Sub7/21.png" width=400>
</p>

<p>If a payload is protected by TLS (Thread Local Storage), the dumped PE file may not function correctly. Therefore, I verified whether TLS protection was actually being used.</p>
<p>To do so, we need to locate the <strong>TLS Directory</strong>. First, navigate to the entry point of the main module using the <strong>Memory Map</strong> in <strong>x32dbg</strong>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/25.png'><img src="/images/article/2026-2-18-Sub7/25.png" width=800>
</p>

<p>Next, right-click the main module and select <strong>Follow in Dump</strong>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/26.png'><img src="/images/article/2026-2-18-Sub7/26.png" width=800>
</p>

<p>The <strong>MZ</strong> signature of a PE file is visible.</p>
<p>Then, locate the value of <code>e_lfanew</code> (PE header offset):<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Address(e_lfanew) = BaseAddress + 0x3C<br></code></pre></td></tr></table></figure></p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/27.png'><img src="/images/article/2026-2-18-Sub7/27.png" width=800>
</p>

<p>The 4-byte result is: <code>00 01 00 00</code>. Since the system uses <strong>little-endian</strong> format, the PE header offset is <code>0x0100</code>. Therefore:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">BaseAddress      = 0x00400000<br>PE Header Offset = 0x0100<br><br>PE Header Address<br>= 0x00400000 + 0x0100<br>= 0x00400100<br></code></pre></td></tr></table></figure>
<p>Navigate to this address in <strong>x32dbg</strong>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/28.png'><img src="/images/article/2026-2-18-Sub7/28.png" width=800>
</p>

<p>The data: <code>50 45 00 00</code> confirms the PE signature. Otherwise, the PE file might be damaged.</p>
<p>Next, locate the <strong>DataDirectory</strong>:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">PE signature size        = 4 bytes<br>IMAGE_FILE_HEADER size   = 20 bytes<br></code></pre></td></tr></table></figure></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Address(IMAGE_OPTIONAL_HEADER)<br>= 0x00400100 + (4 + 20)<br>= 0x00400100 + 0x18<br>= 0x00400118<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">DataDirectory<br>= OptionalHeader + 0x60<br>= 0x00400118 + 0x60<br>= 0x00400178<br></code></pre></td></tr></table></figure>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/29.png'><img src="/images/article/2026-2-18-Sub7/29.png" width=800>
</p>

<p>Each directory entry occupies 8 bytes. The TLS directory is the 9-th entry. Therefore:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">TLS<br>= 0x00400178 + (8 × 9)<br>= 0x00400178 + 0x48<br>= 0x004001C0<br></code></pre></td></tr></table></figure></p>
<p>Notice that the value of <strong>AddressOfCallbacks</strong> is zero, indicating that no TLS callback is defined. Therefore, it is reasonable to assume that the TLS structure was added by Delphi by default.</p>
<p>After further studying, I confirmed that the Import Address Table (IAT) of the dumped PE file was not properly fixed. Therefore, it needed to be repaired using Scylla. (Scylla also provides functionality for rebuilding the IAT after identifying the correct OEP.)</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/22.png'><img src="/images/article/2026-2-18-Sub7/22.png" width=400>
</p>

<p>The sections displayed in <strong>Program Trees</strong> were still incorrect. In this case, the payload can be modified using <strong>CFF Explorer</strong>:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/19.png'><img src="/images/article/2026-2-18-Sub7/19.png" width=800>
</p>

<p>Note that the <strong>Raw Size</strong> should be adjusted to match the <strong>Virtual Size</strong>, and the <strong>SizeOfImage</strong> value must also be corrected:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/23.png'><img src="/images/article/2026-2-18-Sub7/23.png" width=800>
</p>

<p>After performing these steps, the payload can be properly analyzed in Ghidra</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/20.png'><img src="/images/article/2026-2-18-Sub7/20.png" width=800>
</p>

<p>I also successfully unpacked version 2.3 payload, which is packed with <strong>ASPack</strong>. The unpacking method will be covered in a separate article.</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/30.png'><img src="/images/article/2026-2-18-Sub7/30.png" width=800>
</p>

<h2 id="Message-Handler"><a href="#Message-Handler" class="headerlink" title="Message Handler"></a>Message Handler</h2><p>Since we already identified the plain text used for C2 communication during protocol analysis, we can locate the message handler using Ghidra.</p>
<p>Originally, the function appears as follows in Ghidra:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">void UndefinedFunction_004a6bf4(int *param_1,undefined4 param_2)<br></code></pre></td></tr></table></figure></p>
<p>In this case, navigate to the address <code>004a6bf4</code> in the <strong>Listing</strong> view and create a new function:</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/31.png'><img src="/images/article/2026-2-18-Sub7/31.png" width=1000>
</p>

<p>Although the message handler looks quite complex at first glance, we can still understand its mechanism. Like the majority of RATs, it identifiers different C2 commands using integer values and responds accordingly to the controller.</p>
<p align="center" class='item-img' data-src='/images/article/2026-2-18-Sub7/32.png'><img src="/images/article/2026-2-18-Sub7/32.png" width=800>
</p>

<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>The most challenge part of this analysis was unpacking the payload. During this process, I could hardly find a tool for easily unpacking a payload packed with an obsolete version of UPX. After further investigation with <strong>x32dbg</strong>, I noticed that the payload was likely packed with UPX 0.72.</p>
<p>ALthough manual unpacking was quite difficult for me as a begineer, I learned a great deal from the process. It also helped me successfully unpack with ASPack. Additionally, this exercise served as a valuable review of the PE file format.</p>
<h1 id="THANKS-FOR-READING"><a href="#THANKS-FOR-READING" class="headerlink" title="THANKS FOR READING"></a>THANKS FOR READING</h1><p align="center" class='item-img' data-src='/images/meme/mika_nagisa_rollcake.gif'><img src="/images/meme/mika_nagisa_rollcake.gif" width=400>
</p><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2026/02/20/2026-2-20-Beast/">← Next [Studying] Analyzing BeastDoor</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2026/02/18/2026-2-18-BackOrifice/">[Studying] Analyzing Back Orifice Prev →</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a target="_blank" rel="noopener" href="https://github.com/iss4cf0ng/" width="200" id="logo"><img src="https://avatars.githubusercontent.com/u/110074064?v=4" alt="Logo"></a><h1 id="Dr"><a href="/">ISSAC</a></h1><div id="description"><p>Everything is failing...</p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/iss4cf0ng/"><i class="fab fa-github" alt="GitHub"></i></a></div></div><div id="music"></div><div class="music-box"><hr style="border:1px solid #ccc; margin:10px 0"><p class="music-title">Feeling exhausted? Let's enjoy (やさしい) music!</p><p style="text-align:center; position: relative"><img class="music-anime" id="anime-img" src="/images/meme/himari_coffee.2.jpg" width="150" height="200"></p><div><button class="music-btn" id="music-toggle">▶ Play Music</button><span id="music-index" style="margin-left:10px"></span></div><hr style="border:1px solid #ccc; margin:10px 0"><audio id="bg-music"><source src="/mp3/music/music_1.mp3" type="audio/mpeg"></audio><script>document.addEventListener("DOMContentLoaded", function () {
  var playlist = [
    "/mp3/music/music_1.mp3",
    "/mp3/music/sugar_story.mp3",
    "/mp3/music/story_music_box.mp3",
    "/mp3/music/musa.mp3",
    "/mp3/music/air.mp3",
    "/mp3/music/last_page.mp3",
  ];

  var current = 0;
  const audio = document.getElementById("bg-music");
  const btn = document.getElementById("music-toggle");
  const indexDisplay = document.getElementById("music-index");

  indexDisplay.innerText = `Currently: ${current + 1} / ${playlist.length}`;

  btn.addEventListener("click", function () {
    if (audio.paused) {
      audio.src = playlist[current];
      audio.play();
      btn.innerText = "⏸ Pause Music";
    } else {
      audio.pause();
      btn.innerText = "▶ Play Music";
    }
  });

  audio.addEventListener("ended", function() {
    current = (current + 1) % playlist.length;
    audio.src = playlist[current];
    audio.play();
    indexDisplay.innerText = `Currently: ${current + 1} / ${playlist.length}`;
  });
});
</script><script>document.addEventListener("DOMContentLoaded", function () {
  const animeImg = document.getElementById("anime-img");

  animeImg.addEventListener("click", function() {
    
    const tip = document.createElement("div");
    tip.innerText = "?";
    tip.style.position = "absolute";
    tip.style.top = "-50px";
    tip.style.left = "50%";
    tip.style.transform = "translateX(-50%)";
    tip.style.backgroundColor = "#fff";
    tip.style.color = "rgb(16, 174, 11)";
    tip.style.padding = "2px 6px";
    tip.style.border = "1px solid #ccc";
    tip.style.borderRadius = "8px";
    tip.style.boxShadow = "0 3px 6px rgba(0,0,0,0.2)";
    tip.style.fontSize = "50px";
    tip.style.fontWeight = "bold";
    tip.style.zIndex = "1000";
    tip.style.opacity = "1";
    tip.style.transition = "opacity 1s, top 1s";
    
    animeImg.parentElement.appendChild(tip);

    setTimeout(() => {
      tip.style.opacity = "0";
      tip.style.top = "-60px";
      setTimeout(() => tip.remove(), 1000);
    }, 2000);
  });
});
</script></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sub7"><span class="toc-number">2.</span> <span class="toc-text">Sub7</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Experimental-Environment"><span class="toc-number">3.</span> <span class="toc-text">Experimental Environment</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Usage"><span class="toc-number">4.</span> <span class="toc-text">Usage</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Protocol-Analysis"><span class="toc-number">5.</span> <span class="toc-text">Protocol Analysis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse-Engineering"><span class="toc-number">6.</span> <span class="toc-text">Reverse Engineering</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unpacking"><span class="toc-number">6.1.</span> <span class="toc-text">Unpacking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Handler"><span class="toc-number">6.2.</span> <span class="toc-text">Message Handler</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusion"><span class="toc-number">7.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#THANKS-FOR-READING"><span class="toc-number">8.</span> <span class="toc-text">THANKS FOR READING</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/custom.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script src="/js/slide.js"></script></body></html>